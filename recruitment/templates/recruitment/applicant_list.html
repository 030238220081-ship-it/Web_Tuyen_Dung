{% extends 'recruitment/base.html' %}
{% block title %}Danh s√°ch ·ª©ng vi√™n cho {{ job.title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2">·ª®ng vi√™n cho v·ªã tr√≠:</h1>
        <h2 class="h3 text-primary">{{ job.title }}</h2>
    </div>
    <a href="{% url 'recruiter_dashboard' %}" class="btn btn-secondary">Quay l·∫°i Dashboard</a>
</div>


{% for application in applications %}
<div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="mb-0">
            ·ª®ng vi√™n: {{ application.candidate.profile.full_name|default:application.candidate.username }}
        </h4>
        
        {% if application.status == 'passed' %}
            <span class="badge bg-success">ƒê√£ tr√∫ng tuy·ªÉn</span>
        {% elif application.status == 'rejected' %}
            <span class="badge bg-danger">ƒê√£ t·ª´ ch·ªëi</span>
        {% elif application.status == 'confirmed' %}
            <span class="badge bg-primary">ƒê√£ x√°c nh·∫≠n ph·ªèng v·∫•n</span>
        {% elif application.status == 'invited' %}
            <span class="badge bg-info">ƒê√£ g·ª≠i l·ªùi m·ªùi</span>
        {% else %}
            <span class="badge bg-secondary">Ch·ªù x·ª≠ l√Ω</span>
        {% endif %}
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-7">
                <p><strong>Ng√†y n·ªôp:</strong> {{ application.applied_at|date:"H:i, d/m/Y" }}</p>
                
                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ application.cv.url }}" target="_blank" class="btn btn-sm btn-outline-primary">Xem CV g·ªëc</a>
                    <a href="{% url 'chat_view' application.id %}" class="btn btn-sm btn-info">Chat</a>
                    
                    {% if application.status == 'pending' or application.status == 'confirmed' %}
                        <a href="{% url 'process_application' application.id %}" class="btn btn-sm btn-success">
                            <i class="bi bi-check-circle-fill"></i> X·ª≠ l√Ω h·ªì s∆°
                        </a>
                    {% endif %}
                    </div>
            </div>

            <div class="col-md-5 border-start">
                <h5 class="mt-2 mt-md-0">ü§ñ ƒê√°nh gi√° t·ª´ AI ü§ñ</h5>
                
                {% if application.ai_score == 0 and "·ª®ng tuy·ªÉn nhanh" in application.ai_summary %}
                    <div class="alert alert-secondary py-2">
                        <p class="mb-1 small">·ª®ng vi√™n n√†y ƒë√£ n·ªôp h·ªì s∆° b·∫±ng t√≠nh nƒÉng "·ª®ng tuy·ªÉn nhanh" v√† ch∆∞a ƒë∆∞·ª£c ph√¢n t√≠ch.</p>
                        <a href="{% url 're_analyze_application' application.id %}" class="btn btn-sm btn-info w-100">Ch·∫°y ph√¢n t√≠ch AI</a>
                    </div>
                {% else %}
                    <p><strong>ƒêi·ªÉm ph√π h·ª£p:</strong> {{ application.ai_score }} / 100</p>
                    <p class="mb-1"><strong>T√≥m t·∫Øt:</strong></p>
                    <div class="bg-light p-2 rounded small" style="white-space: pre-wrap;">
                        {{ application.ai_summary|linebreaks }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="alert alert-info">Ch∆∞a c√≥ ·ª©ng vi√™n n√†o n·ªôp h·ªì s∆° cho v·ªã tr√≠ n√†y.</div>
{% endfor %}

{% endblock %}